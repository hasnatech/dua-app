import{r as s,b as C,j as i}from"./app-CMgd9CFO.js";import{T as U}from"./textarea-B5qz7GR0.js";import{A as F}from"./application-layout-cxP3cXNc.js";import{P as S}from"./types-BJro-4LP.js";import W from"./AgGridTable-Ml2x6P89.js";import{ICCellRenderer as _}from"./Components-CmBqXCa1.js";import G from"./ConfirmModal-CGEyfTgQ.js";import{e as V,a as B,f as H,m as L,C as $,g as J,b as y,h as K,i as E,j as q,F as z}from"./renderers-BwbMJDu8.js";import{SaveNotification as Q}from"./SaveNotification-BwEY2dnL.js";import M from"./WhatsApp-fNn4roSf.js";import{u as X}from"./useTranslation-Ca9ACeu7.js";import"./utils-jAU0Cazi.js";import"./createLucideIcon-7qGfDxei.js";import"./paw-print-D0UC6vtx.js";import"./sparkles-DqCGk1FT.js";import"./calendar-C2mHZHpm.js";import"./plus-CceXe7IT.js";import"./user-BaUwBdqr.js";import"./search-LkEQWFqZ.js";import"./index-BuHSMQr-.js";import"./loader-circle-Ck6Q4JL4.js";import"./octagon-x-BipK8g0c.js";import"./circle-check-_zxMHciY.js";import"./WeeklyStatus-D3d20abn.js";import"./chevron-left-CX5OGnks.js";import"./chevron-right-NGM6CfF9.js";import"./library-E2nNABdg.js";import"./sun-DGPMDXGc.js";import"./PetDetailsSidebar-BDRneoM-.js";import"./constant-C0FE7K3f.js";import"./index-DZZQifJx.js";import"./send-CvqZSALe.js";import"./x-BWEyVoTj.js";import"./check-D-GLxgsM.js";function je({pets:c,settings:d,search:A}){const{t:a}=X(),[m,b]=s.useState(c.data),[o,N]=s.useState({isOpen:!1,pet:null}),[p,v]=s.useState({isOpen:!1}),[f,u]=s.useState({isOpen:!1,message:"",type:"default"});s.useEffect(()=>{b(c.data)},[c.data]);const O=()=>{N({isOpen:!1,pet:null})},I=()=>{o.pet&&C.post(route("notifications.send",{pet_id:o.pet.id,title:"WhatsApp start message sent",message:R,type:"Whatsapp",data:{petId:o.pet.id,page:"CremationRoom"}}),{notificationSent:!0}).then(e=>{const t=e.data.data,r=[...o.pet.notifications||[],t];n({...o.pet,notificationSent:!0,notifications:r})}).catch(e=>{u({isOpen:!0,message:a("failedToSendNotification",{error:e.message}),type:"danger"})}),O()},[R,h]=s.useState("");s.useEffect(()=>{var e,t,r;o.isOpen&&((t=(e=o.pet)==null?void 0:e.customer)!=null&&t.name)&&((r=o.pet)!=null&&r.name)?h(d.whatsappStart.replace("{ownerName}",o.pet.customer.name).replace("{petName}",o.pet.name)):o.isOpen||h("")},[o.isOpen,o.pet]);const[P,g]=s.useState("idle"),[j,x]=s.useState(null),n=s.useCallback(e=>{console.log("handleUpdatePet",e),b(t=>t.map(r=>r.id===e.id?e:r)),g("saving"),x(null),C.post(route("pet.update-pet",{id:e.id}),e).then(t=>{g("success"),u({isOpen:!0,message:a("successfullySaved"),type:"success"})}).catch(t=>{u({isOpen:!0,message:a("failedToUpdatePet",{error:t.message}),type:"danger"}),g("failure"),x(t.message||a("errorUnknown"))})},[]),w=(e,t)=>{v({isOpen:!0,text:e,title:t})},[Y,T]=s.useState([]),D=s.useMemo(()=>{const e=[],t=[];for(let r=0;r<=d.ovenCount;r++)t.push(r),e[r]=m.filter(l=>l.chamber===r).length;return T(e),t},[d.ovenCount]);s.useEffect(()=>{const e=[];for(let t=0;t<=d.ovenCount;t++)e[t]=m.filter(r=>r.chamber===t).length;T(e)},[m]);const k=s.useMemo(()=>[{colId:"no",headerName:a("no"),valueGetter:"node.rowIndex + 1",width:60,pinned:"left"},{colId:"name",headerName:a("name"),cellRenderer:V,valueGetter:e=>{var t;return(t=e.data)==null?void 0:t.name},pinned:"left",wrapText:!0,autoHeight:!0},{field:"weight",headerName:a("weight"),editable:!0,cellDataType:"number",cellClass:"editable-cell",width:100,valueFormatter:e=>e.value?`${e.value}kg`:""},{field:"cremationType",headerName:a("cremationTypeAbbr"),width:120,cellRenderer:_},{field:"notification",headerName:a("notification"),width:80,cellRenderer:B,cellRendererParams:{onUpdatePet:n}},{field:"tagNumber",headerName:a("tag"),editable:!0,cellClass:"editable-cell",valueSetter:e=>{var l;const t=((l=e.newValue)==null?void 0:l.toString())??"",r=/^\d{15}$/.test(t);return e.data.tagNumber=e.newValue,r?n({...e.data,tagNumber:e.newValue}):(alert("Please enter 15 digit number."),t.trim()==""&&(e.data.tagNumber="",n({...e.data,tagNumber:""}))),!0},cellClassRules:{"cell-error":e=>{var t;return((t=e.data)==null?void 0:t.tagNumberInvalid)===!0}},tooltipValueGetter:e=>{var t;return(t=e.data)!=null&&t.tagNumberInvalid?"Tag number must be exactly 15 digits.":""}},{field:"chamber",headerName:a("chamber"),width:110,editable:!0,cellEditor:"agSelectCellEditor",cellEditorParams:{values:D},valueFormatter:e=>e.value===0?"":e.value,cellClass:"editable-cell"},{field:"hasProstheses",headerName:a("prostheses"),width:120,cellRenderer:H},{field:"status",headerName:a("status"),cellRenderer:$,minWidth:180,cellEditor:"agSelectCellEditor",cellEditorParams:{values:[S.WAITING,S.CREMATION_STARTED,S.CREMATION_ENDED]},valueSetter:e=>{const{data:t,newValue:r}=e;let l;return l=r,n({...t,status:l}),!0},valueGetter:e=>L(e.data.status),editable:!0},{colId:"start",headerName:a("start"),headerComponentParams:{icon:M},headerComponent:y,cellRenderer:J,cellRendererParams:{setModalState:N},width:120,sortable:!1,filter:!1},{headerName:a("end"),headerComponentParams:{icon:M},headerComponent:y,cellRenderer:K,cellRendererParams:{markNotificationAsOkToSend:e=>{C.post(route("notifications.send",{pet_id:e.id,title:"User notified",message:"Cremation Finished - Admin Notified",type:"System",data:{petId:e.id,page:"CremationRoom"}})).then(()=>{n({...e,chamber:0,notify:{notifiy_admin:{page:"cremation_room",send:!0}}})}).catch(t=>{u({isOpen:!0,message:a("failedToSendNotification",{error:t.message}),type:"danger"})})}},sortable:!1,filter:!1,width:150},E("engraving",a("engraving"),w,n,()=>{}),E("others_info",a("other"),w,n,()=>{}),{field:"pickupDateTime",headerName:a("pickUp"),flex:1,minWidth:180,valueFormatter:e=>e.data.isPickupDate==!0?a("ashesHereUntilUrnJewelryArrives"):e.value?new Date(e.value).toLocaleString("nl-BE"):""}],[n,a]);return i.jsxs(F,{children:[i.jsx(q,{isOpen:f.isOpen,type:f.type,message:f.message}),i.jsx(Q,{status:P,errorMessage:j}),i.jsx(W,{title:a("cremationRoom"),description:a("cremationRoomDesc"),settings:d,pets:m,columnDefs:k,date:new Date().toISOString().split("T")[0],getRowStyle:e=>({background:e.data.status==="Cremation ended"?"#e4dfd6":e.data.preparationStatus==="Completed"?"#c5f2c5":""}),onUpdatePet:n,search:A}),i.jsx(G,{isOpen:o.isOpen,onClose:O,onConfirm:I,title:a("confirmNotification"),message:o.pet?i.jsxs(i.Fragment,{children:[i.jsx("p",{className:"mb-4",children:a("confirmSendMessage")}),i.jsx(U,{className:"bg-panel w-full rounded-lg border border-border p-3 text-sm text-primary",value:R,onChange:e=>h(e.target.value),placeholder:a("message")})]}):null}),p.isOpen&&i.jsx(z,{isOpen:p.isOpen,title:p.title,text:p.text,onClose:()=>v({isOpen:!1,title:"",text:""})})]})}export{je as default};
