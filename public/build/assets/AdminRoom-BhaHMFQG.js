import{K as U,r as s,b as R,j as i}from"./app-CMgd9CFO.js";import{T as G}from"./textarea-B5qz7GR0.js";import{t as c,A as _}from"./application-layout-cxP3cXNc.js";import{P as u}from"./types-BJro-4LP.js";import k from"./AgGridTable-Ml2x6P89.js";import{ICCellRenderer as H}from"./Components-CmBqXCa1.js";import q from"./ConfirmModal-CGEyfTgQ.js";import{N as L,a as z,m as J,C as K,S as V,b as C,c as Q,d as X,O as Y,A as Z,F as $}from"./renderers-BwbMJDu8.js";import{SaveNotification as B}from"./SaveNotification-BwEY2dnL.js";import N from"./WhatsApp-fNn4roSf.js";import{u as ee}from"./useTranslation-Ca9ACeu7.js";import"./utils-jAU0Cazi.js";import"./createLucideIcon-7qGfDxei.js";import"./paw-print-D0UC6vtx.js";import"./sparkles-DqCGk1FT.js";import"./calendar-C2mHZHpm.js";import"./plus-CceXe7IT.js";import"./user-BaUwBdqr.js";import"./search-LkEQWFqZ.js";import"./index-BuHSMQr-.js";import"./loader-circle-Ck6Q4JL4.js";import"./octagon-x-BipK8g0c.js";import"./circle-check-_zxMHciY.js";import"./WeeklyStatus-D3d20abn.js";import"./chevron-left-CX5OGnks.js";import"./chevron-right-NGM6CfF9.js";import"./library-E2nNABdg.js";import"./sun-DGPMDXGc.js";import"./PetDetailsSidebar-BDRneoM-.js";import"./constant-C0FE7K3f.js";import"./index-DZZQifJx.js";import"./send-CvqZSALe.js";import"./x-BWEyVoTj.js";import"./check-D-GLxgsM.js";function We({pets:f,settings:p,search:I}){const{t:r}=ee(),{flash:n}=U().props,[P,h]=s.useState(f.data),[a,S]=s.useState({isOpen:!1,pet:null}),[m,x]=s.useState({isOpen:!1}),w=()=>{S({isOpen:!1,pet:null})},A=()=>{a.pet&&R.post(route("notifications.send",{pet_id:a.pet.id,title:"WhatsApp end message sent",message:E,type:"Whatsapp",data:{petId:a.pet.id,page:"AdminRoom"}}),{notificationSent:!0}).then(e=>{const t=e.data.data,o=[...a.pet.notifications||[],t];l({...a.pet,notificationSent:!0,notifications:o}),c.success(r("successfullySaved"))}).catch(e=>{c.error(r("failedToSendNotification",{error:e.message}))}),w()},[E,g]=s.useState("");s.useEffect(()=>{if(a.isOpen&&a.pet&&p.whatsappStart){let e=p.whatsappStart;console.log(p),a.pet.status===u.CREMATION_ENDED&&(e=p.whatsappStop),a.pet.customer.name&&(e=e.replace("{ownerName}",a.pet.customer.name)),a.pet.name&&(e=e.replace("{petName}",a.pet.name)),g(e)}else a.isOpen||g("")},[a.isOpen,a.pet]),s.useEffect(()=>{h(f.data)},[f.data]);const[D,T]=s.useState("idle"),[j,O]=s.useState(null);s.useEffect(()=>{n!=null&&n.success&&c.success(n.success,{position:"bottom-right",duration:4e3}),n!=null&&n.error&&c.error(n.error,{position:"bottom-right",duration:4e3})},[n]);const l=e=>{h(o=>o.map(d=>d.id===e.id?e:d));const t={...e};delete t.notifications,T("saving"),O(null),R.post(route("pet.update-pet",{id:e.id}),t).then(o=>{console.log("Pet updated successfully:",o.data),T("success")}).catch(o=>{console.error("Error updating pet:",o),O(o.message||r("errorUnknown"))})},v=(e,t)=>{x({isOpen:!0,text:e,title:t})},W=s.useMemo(()=>[{colId:"no",headerName:r("no"),valueGetter:"node.rowIndex + 1",width:60,pinned:"left"},{colId:"name",headerName:r("name"),cellRenderer:L,width:120,valueGetter:e=>{var t;return(t=e.data)==null?void 0:t.name},pinned:"left",wrapText:!0,autoHeight:!0},{field:"cremationType",headerName:r("cremationTypeAbbr"),width:120,cellRenderer:H},{field:"notification",headerName:r("notification"),width:80,cellRenderer:z,cellRendererParams:{onUpdatePet:l}},{field:"status",headerName:r("status"),cellRenderer:K,minWidth:180,cellEditor:"agSelectCellEditor",cellEditorParams:{values:[u.WAITING,u.CREMATION_STARTED,u.CREMATION_ENDED]},valueSetter:e=>{const{data:t,newValue:o}=e;return t.status!==o&&l({...t,status:o}),!0},valueGetter:e=>J(e.data.status),editable:!0},{colId:"start",headerName:r("start"),headerComponentParams:{icon:N},headerComponent:C,cellRenderer:V,width:100},{colId:"stop",headerName:r("end"),headerComponentParams:{icon:N},headerComponent:C,cellRenderer:Q,width:150},{colId:"send",headerName:r("send"),headerComponentParams:{icon:N},headerComponent:C,cellRenderer:X,cellRendererParams:{setModalState:S},width:120,sortable:!1,filter:!1},{field:"comments",headerName:r("other"),cellRenderer:Y,cellRendererParams:{openFullTextModal:v,title:r("other"),content:e=>{var t;return((t=e.data)==null?void 0:t.others_info)||""}}},{colId:"message",headerName:r("message"),valueGetter:e=>{var t,o;return(t=e.data)!=null&&t.hasProstheses?((o=e.data)==null?void 0:o.prosthesesDetails)??"":""},minWidth:150},{field:"pickupDateTime",headerName:r("pickUp"),flex:1,minWidth:180,comparator:(e,t,o,d,M)=>{const b=e==null||e==="",y=t==null||t==="";return b&&y?0:b?M?-1:1:y?M?1:-1:e==t?0:e>t?1:-1},valueFormatter:e=>e.data.isPickupDate==!0?r("ashesHereUntilUrnJewelryArrives"):e.value?new Date(e.value).toLocaleString("nl-BE"):""},{colId:"actions",headerName:r("actions"),width:170,pinned:"right",cellRenderer:Z,cellRendererParams:{onDelete:e=>F(e)},sortable:!1,filter:!1,resizable:!1}],[l]),F=e=>{confirm("Do you want to delete this record?")&&(console.log(e),R.delete(route("cremation.destroy",e.id)).then(t=>{console.log(t),h(o=>o.filter(d=>d.id!==e.id))}).catch(t=>{console.error("Error deleting record:",t),alert("Failed to delete the record. Please try again.")}))};return i.jsxs(_,{children:[i.jsx(B,{status:D,errorMessage:j}),i.jsx(k,{title:r("allRequests"),description:r("allRequestsDesc"),pets:P,columnDefs:W,onUpdatePet:l,search:I}),i.jsx(q,{isOpen:a.isOpen,onClose:w,onConfirm:A,title:r("confirmNotification"),message:a.pet?i.jsxs(i.Fragment,{children:[i.jsx("p",{className:"mb-4",children:r("confirmSendMessage")}),i.jsx(G,{className:"bg-panel w-full rounded-lg border border-border p-3 text-sm text-primary",value:E,onChange:e=>g(e.target.value),placeholder:r("message")})]}):null}),m.isOpen&&i.jsx($,{isOpen:m.isOpen,title:m.title,text:m.text,onClose:()=>x({isOpen:!1,title:"",text:""})})]})}export{We as default};
